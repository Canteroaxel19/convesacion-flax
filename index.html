<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Conversaci√≥n Flax Pro</title>
    <style>
        :root {
            --primary: #007AFF;
            --secondary: #32D74B;
            --bg: #000000;
            --surface: #1C1C1E;
            --text: #FFFFFF;
            --accent-red: #FF453A;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        /* BARRA DE DESPLAZAMIENTO ESTILO COMPUTADORA */
        ::-webkit-scrollbar { width: 10px; display: block; }
        ::-webkit-scrollbar-track { background: #000; }
        ::-webkit-scrollbar-thumb { background: var(--primary); border-radius: 10px; border: 2px solid #000; }

        body, html {
            margin: 0; padding: 0; min-height: 100%; width: 100%;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: var(--bg); color: var(--text);
            overflow-x: hidden; overflow-y: auto;
        }

        /* Pantalla de Introducci√≥n (Solo 3 veces) */
        #intro-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at center, #1c1c1e 0%, #000 100%);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            z-index: 3000; padding: 30px; text-align: center; overflow-y: auto;
        }

        /* Modal de Instrucciones */
        #modal-instrucciones {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); display: none; flex-direction: column;
            align-items: center; justify-content: center; z-index: 4000; padding: 25px;
        }

        .instrucciones-box {
            background: var(--surface); padding: 20px; border-radius: 20px;
            max-width: 500px; text-align: left; border: 1px solid var(--primary);
            max-height: 80vh; overflow-y: auto;
        }

        .title-main { font-size: 2.2rem; font-weight: 800; color: var(--primary); margin-bottom: 5px; }
        .subtitle-main { font-size: 1.1rem; color: #8E8E93; margin-bottom: 20px; }

        .action-btn {
            background: var(--primary); color: white; border: none; padding: 15px 40px;
            border-radius: 15px; font-weight: 700; font-size: 1.1rem; cursor: pointer;
            box-shadow: 0 8px 20px rgba(0, 122, 255, 0.4); margin-top: 15px;
        }

        /* Interfaz Principal */
        .app-content { display: flex; flex-direction: column; min-height: 100vh; padding-bottom: 40px; }
        .panel { flex: 1; display: flex; flex-direction: column; padding: 25px 20px; justify-content: space-between; min-height: 45vh; }
        .panel-top { transform: rotate(180deg); border-bottom: 0.5px solid #38383A; background: #050505; }
        
        .toolbar { display: flex; justify-content: space-between; align-items: center; }
        .lang-select { background: #1C1C1E; color: white; border: 1px solid var(--primary); padding: 12px; border-radius: 12px; width: 70%; font-size: 1rem; outline: none; }
        .repeat-btn { background: rgba(255,255,255,0.1); border: none; color: white; width: 45px; height: 45px; border-radius: 50%; cursor: pointer; font-size: 1.3rem; }

        .display-box { flex-grow: 1; margin: 20px 0; display: flex; align-items: center; justify-content: center; text-align: center; font-size: 1.6rem; font-weight: 500; }

        .mic-btn { width: 85px; height: 85px; border-radius: 50%; border: none; background: var(--primary); color: white; font-size: 32px; margin: 0 auto; cursor: pointer; box-shadow: 0 5px 15px rgba(0,0,0,0.5); }
        .mic-btn.active { background: var(--accent-red); animation: pulse 1.2s infinite; }

        .footer-btn { background: none; border: 1px solid #38383A; color: #8E8E93; padding: 10px 20px; border-radius: 10px; margin: 20px auto; cursor: pointer; display: block; font-size: 0.9rem; }

        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 69, 58, 0.7); }
            70% { transform: scale(1.1); box-shadow: 0 0 0 15px rgba(255, 69, 58, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 69, 58, 0); }
        }
    </style>
</head>
<body>

    <div id="intro-overlay" style="display:none">
        <h1 class="title-main">Conversaci√≥n Flax</h1>
        <p class="subtitle-main">Comienza Hablar Con Personas de Diferentes Idiomas</p>
        <p style="line-height:1.6; color:#8e8e93; max-width:500px;">
            Permite la interpretaci√≥n de voz en tiempo real, traduciendo autom√°ticamente frases habladas entre dos idiomas. Ideal para charlas cara a cara, usa el micr√≥fono para detectar el idioma, traducir y reproducir en voz.
        </p>
        <button class="action-btn" onclick="closeIntro()">ENTENDIDO</button>
    </div>

    <div id="modal-instrucciones" onclick="closeModal()">
        <div class="instrucciones-box" onclick="event.stopPropagation()">
            <h2 style="color:var(--primary); margin-top:0;">Nota Importante</h2>
            <p>Si no escuchas alg√∫n idioma, aseg√∫rate de tener descargado el paquete de voz en los ajustes de tu dispositivo.</p>
            <hr style="border: 0.5px solid #38383A; margin: 15px 0;">
            <p><strong>Sigue estos pasos en tu celular:</strong></p>
            <p>1. Ve a <b>Ajustes > Administraci√≥n General > Idioma e entrada</b>.</p>
            <p>2. Busca <b>Texto a voz</b> (o S√≠ntesis de voz) o "Texto para pronunciar".</p>
            <p>3. En "Motor preferido" (Google), dale al icono de la tuerca <b>‚öôÔ∏è</b>.</p>
            <p>4. Busca <b>"Instalar datos de voz"</b>.</p>
            <p>5. Busca el idioma que quieres escuchar y dale a <b>descargar</b> (flechita hacia abajo).</p>
            <p style="color:var(--secondary); font-weight:bold;">¬°Una vez descargado, Flax empezar√° a hablar m√°gicamente!</p>
            <button class="action-btn" style="width:100%" onclick="closeModal()">CERRAR</button>
        </div>
    </div>

    <div class="app-content">
        <div class="panel panel-top">
            <div class="toolbar">
                <select id="sel-top" class="lang-select" onchange="saveConfig()"></select>
                <button class="repeat-btn" onclick="manualSpeak('top')">üîä</button>
            </div>
            <div id="box-top" class="display-box">...</div>
            <button id="mic-top" class="mic-btn" onclick="startMic('top')">üé§</button>
        </div>

        <div class="panel">
            <div class="toolbar">
                <select id="sel-bottom" class="lang-select" onchange="saveConfig()"></select>
                <button class="repeat-btn" onclick="manualSpeak('bottom')">üîä</button>
            </div>
            <div id="box-bottom" class="display-box">Toca para hablar...</div>
            <button id="mic-bottom" class="mic-btn" onclick="startMic('bottom')">üé§</button>
        </div>

        <button class="footer-btn" onclick="openModal()">Instrucciones</button>
    </div>

<script>
    const synth = window.speechSynthesis;
    const SpeechRec = window.SpeechRecognition || window.webkitSpeechRecognition;
    let recognition = SpeechRec ? new SpeechRec() : null;
    let activeSide = null;

    // LISTA DE 30 IDIOMAS ACTUALIZADA
    const languages = [
        { c: "es-ES", n: "üá™üá∏ Espa√±ol" }, { c: "en-US", n: "üá∫üá∏ Ingl√©s" },
        { c: "pt-BR", n: "üáßüá∑ Portugu√©s" }, { c: "zh-CN", n: "üá®üá≥ Chino" },
        { c: "ja-JP", n: "üáØüáµ Japon√©s" }, { c: "hi-IN", n: "üáÆüá≥ India (Hindi)" },
        { c: "ar-SA", n: "üá∏üá¶ Arabia Saudita" }, { c: "ru-RU", n: "üá∑üá∫ Ruso" },
        { c: "de-DE", n: "üá©üá™ Alem√°n" }, { c: "ko-KR", n: "üá∞üá∑ Coreano" },
        { c: "bn-BD", n: "üáßüá© Bengal√≠" }, { c: "fr-FR", n: "üá´üá∑ Franc√©s" },
        { c: "he-IL", n: "üáÆüá± Israel (Hebreo)" }, { c: "it-IT", n: "üáÆüáπ Italiano" },
        { c: "tr-TR", n: "üáπüá∑ Turco" }, { c: "nl-NL", n: "üá≥üá± Holand√©s" },
        { c: "pl-PL", n: "üáµüá± Polaco" }, { c: "vi-VN", n: "üáªüá≥ Vietnamita" },
        { c: "id-ID", n: "üáÆüá© Indonesio" }, { c: "th-TH", n: "üáπüá≠ Tailand√©s" },
        { c: "el-GR", n: "üá¨üá∑ Griego" }, { c: "da-DK", n: "üá©üá∞ Dan√©s" },
        { c: "fi-FI", n: "üá´üáÆ Finland√©s" }, { c: "no-NO", n: "üá≥üá¥ Noruego" },
        { c: "hu-HU", n: "üá≠üá∫ H√∫ngaro" }, { c: "cs-CZ", n: "üá®üáø Checo" },
        { c: "ro-RO", n: "üá∑üá¥ Rumano" }, { c: "uk-UA", n: "üá∫üá¶ Ucraniano" },
        { c: "ms-MY", n: "üá≤üáæ Malayo" }, { c: "sv-SE", n: "üá∏üá™ Sueco" }
    ];

    window.onload = () => {
        const sTop = document.getElementById('sel-top');
        const sBot = document.getElementById('sel-bottom');
        languages.forEach(l => {
            const opt = `<option value="${l.c}">${l.n}</option>`;
            sTop.innerHTML += opt;
            sBot.innerHTML += opt;
        });

        sTop.value = localStorage.getItem('flax_top') || "en-US";
        sBot.value = localStorage.getItem('flax_bottom') || "es-ES";

        checkIntro();
    };

    function saveConfig() {
        localStorage.setItem('flax_top', document.getElementById('sel-top').value);
        localStorage.setItem('flax_bottom', document.getElementById('sel-bottom').value);
    }

    function checkIntro() {
        let count = parseInt(localStorage.getItem('flax_intro_count') || "0");
        if (count < 3) document.getElementById('intro-overlay').style.display = 'flex';
    }

    function closeIntro() {
        let count = parseInt(localStorage.getItem('flax_intro_count') || "0");
        localStorage.setItem('flax_intro_count', (count + 1).toString());
        document.getElementById('intro-overlay').style.display = 'none';
        synth.speak(new SpeechSynthesisUtterance(""));
    }

    function openModal() { document.getElementById('modal-instrucciones').style.display = 'flex'; }
    function closeModal() { document.getElementById('modal-instrucciones').style.display = 'none'; }

    async function translate(text, from, to) {
        try {
            const res = await fetch(`https://translate.googleapis.com/translate_a/single?client=gtx&sl=${from.split('-')[0]}&tl=${to.split('-')[0]}&dt=t&q=${encodeURI(text)}`);
            const data = await res.json(); return data[0][0][0];
        } catch(e) { return text; }
    }

    function startMic(side) {
        if (!recognition || activeSide) return;
        activeSide = side;
        recognition.lang = document.getElementById(`sel-${side}`).value;
        recognition.start();
        document.getElementById(`mic-${side}`).classList.add('active');
    }

    if (recognition) {
        recognition.onresult = async (e) => {
            const text = e.results[0][0].transcript;
            const other = activeSide === 'bottom' ? 'top' : 'bottom';
            const toL = document.getElementById(`sel-${other}`).value;
            document.getElementById(`box-${activeSide}`).innerText = text;
            const res = await translate(text, recognition.lang, toL);
            speak(res, toL, other);
        };
        recognition.onend = () => {
            document.querySelectorAll('.mic-btn').forEach(b => b.classList.remove('active'));
            activeSide = null;
        };
    }

    function manualSpeak(side) {
        const text = document.getElementById(`box-${side}`).innerText;
        const lang = document.getElementById(`sel-${side}`).value;
        if (text !== "..." && text !== "") speak(text, lang, side);
    }

    function speak(text, lang, side) {
        synth.cancel();
        const utt = new SpeechSynthesisUtterance(text);
        utt.lang = lang;
        document.getElementById(`box-${side}`).innerText = text;
        const v = synth.getVoices().find(v => v.lang.startsWith(lang.split('-')[0]));
        if (v) utt.voice = v;
        synth.speak(utt);
    }
    window.speechSynthesis.onvoiceschanged = () => synth.getVoices();
</script>
</body>
</html>
